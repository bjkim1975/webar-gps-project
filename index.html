<!DOCTYPE html>
<html>
<head>
    <title>AR GPS Navigation</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .info { position: fixed; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="info">
        <p>현재 위치: <span id="current-position">Loading...</span></p>
        <p>목적지 위치: <span id="destination-position">Loading...</span></p>
    </div>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
        <!-- 정육면체 엔티티 정의 -->
        <a-box id="destination-box" position="0 0.15 0" depth="0.3" height="0.3" width="0.3" color="red" gps-entity-place></a-box>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let initialDestination = null;

        function updateARObject(lat, lon) {
            const box = document.getElementById('destination-box');
            box.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon}`);
        }

        function updateDisplay(currentLat, currentLon, destinationLat, destinationLon) {
            document.getElementById('current-position').textContent = `${currentLat.toFixed(6)}, ${currentLon.toFixed(6)}`;
            document.getElementById('destination-position').textContent = `${destinationLat.toFixed(6)}, ${destinationLon.toFixed(6)}`;
        }

        function success(pos) {
            const crd = pos.coords;
            const currentLat = crd.latitude;
            const currentLon = crd.longitude;

            if (!initialDestination) {
                // 초기 목적지 위치 설정 (현재 위치에서 북쪽으로 10 미터)
                initialDestination = turf.destination(turf.point([currentLon, currentLat]), 10, {units: 'meters', properties: {bearing: 0}});
                const destinationLat = initialDestination.geometry.coordinates[1];
                const destinationLon = initialDestination.geometry.coordinates[0];
                updateARObject(destinationLat, destinationLon);
            }

            // 화면에 현재 위치와 목적지 위치 업데이트
            updateDisplay(currentLat, currentLon, initialDestination.geometry.coordinates[1], initialDestination.geometry.coordinates[0]);
        }

        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
        }

        const options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };

        setInterval(function() {
            navigator.geolocation.getCurrentPosition(success, error, options);
        }, 1000);
    </script>
</body>
</html>
